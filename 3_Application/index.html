<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcolatore Informazioni Pagina Web</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            background-color: #fff;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        h2 {
            margin-top: 0;
        }

        .progress {
    height: 20px;
    background-color: #a3a3a3;
    border-radius: 5px;
    overflow: hidden;
    margin-top: 10px;
}

.progress-bar {
    height: 100%;
    background-color: #28a745;
    transition: width 0.5s ease-in-out;
}


    </style>
</head>
<body>
    <div class="container">
        <h1>Calcolatore Informazioni Pagina Web</h1>
        <div class="form-group">
            <label for="url">Inserisci l'URL della pagina web:</label>
            <input type="text" id="url" placeholder="https://www.example.com">
        </div>
        <button onclick="getPageDetails()">Calcola Informazioni</button>
        <div id="result" class="result" style="display: none;">
            <h2>Risultato per il sito: <span id="site-name"></span></h2>
            <p id="page-size"></p>
            <p id="energy-consumption"></p>
            <p id="http-requests"></p>
            <p id="external-resources"></p>
            <p id="content-type"></p>
            <p id="response-time"></p>
            <p id="carbon-emissions"></p>
            <div class="progress">
                <div id="carbon-emissions-bar" class="progress-bar"></div>
            </div>
        </div>
    </div>

<script>
   async function getPageDetails() {
    const url = document.getElementById('url').value;
    if (!url) {
        alert('Per favore, inserisci un URL valido.');
        return;
    }

    try {
        const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
        if (!response.ok) {
            throw new Error('Errore nel recupero dei dati della pagina');
        }
        const data = await response.json();

        const pageSizeBytes = new Blob([data.contents]).size;
        const pageSizeKB = pageSizeBytes / 1024;
        const pageSizeMB = pageSizeKB / 1024;

        const energyConsumption = calculateEnergyConsumption(pageSizeBytes);
        const carbonEmissions = calculateCarbonEmissions(energyConsumption);
        const httpRequests = getHttpRequests(data.contents);
        const externalResources = getExternalResources(data.contents);
        const contentType = getContentType(data.contents);
        const responseTime = calculateResponseTime();

        document.getElementById('site-name').innerText = getSiteName(url);
        document.getElementById('page-size').innerText = `Peso della pagina web: ${pageSizeMB.toFixed(2)} MB`;
        document.getElementById('energy-consumption').innerText = `Consumo di elettricità stimato: ${energyConsumption.toFixed(2)} kWh`;
        document.getElementById('http-requests').innerText = `Numero di richieste HTTP: ${httpRequests}`;
        document.getElementById('external-resources').innerText = `Numero di risorse esterne: ${externalResources}`;
        document.getElementById('content-type').innerText = `Tipo di contenuto: ${contentType}`;
        document.getElementById('response-time').innerText = `Tempo di risposta: ${responseTime} ms`;
        document.getElementById('carbon-emissions').innerText = `Emissioni di carbonio: ${carbonEmissions.toFixed(2)} g CO2`;

        // Aggiornamento della larghezza della barra di progresso
        const maxCarbonEmissions = 100; // Valore massimo di emissioni di CO2 in kg CO2 equivalenti
        const carbonEmissionsPercentage = (carbonEmissions / maxCarbonEmissions) * 100;
        document.getElementById('carbon-emissions-bar').style.width = `${carbonEmissionsPercentage}%`;

        document.getElementById('result').style.display = 'block';
    } catch (error) {
        console.error('Errore durante il recupero delle informazioni:', error);
        alert('Si è verificato un errore durante il recupero delle informazioni. Per favore, riprova.');
    }
}


function calculateCarbonEmissions(energyConsumption) {
    // Utilizzare un fattore di conversione per calcolare le emissioni di carbonio
    const conversionFactor = 0.12; // kg CO2 emesse per ogni kWh di energia consumata
    const carbonEmissions = energyConsumption * conversionFactor;
    return carbonEmissions;
}



function calculateResponseTime() {
    // Utilizzare performance.timing per ottenere il tempo di risposta della pagina
    const pageLoadTime = performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart;
    return pageLoadTime;
}

    function calculateEnergyConsumption(pageSizeBytes) {
        // Utilizzare dati reali per il consumo di energia per byte trasferito
        // Ad esempio, 0.000015 kWh per byte (valore ipotetico)
        const energyPerByte = 0.000015; // Consumo energetico per byte trasferito (kWh)

        // Calcolo del consumo di energia totale (kWh)
        const totalEnergyConsumption = pageSizeBytes * energyPerByte;

        return totalEnergyConsumption;
    }

    function getHttpRequests(pageContent) {
        // Conta il numero di occorrenze di 'http' nel contenuto della pagina
        const httpMatches = pageContent.match(/http/gi);
        return httpMatches ? httpMatches.length : 0;
    }

    function getExternalResources(pageContent) {
        // Conta il numero di occorrenze di tag per le risorse esterne (img, link, script, ecc.)
        const externalResourceMatches = pageContent.match(/<(img|link|script|audio|video|iframe)\s/gi);
        return externalResourceMatches ? externalResourceMatches.length : 0;
    }

    function getContentType(pageContent) {
        // Estrai il tipo di contenuto dalla stringa dei metadati
        const contentTypeMatch = pageContent.match(/<meta\s+.*?http-equiv=["']?content-type["']?\s+.*?>/gi);
        if (contentTypeMatch) {
            const contentTypeValueMatch = contentTypeMatch[0].match(/content=["']?([^"'>]+)["']?/i);
            if (contentTypeValueMatch && contentTypeValueMatch[1]) {
                return contentTypeValueMatch[1];
            }
        }
        return 'Non disponibile';
    }

    function getSiteName(url) {
        // Estrae il nome del sito dall'URL
        const hostname = new URL(url).hostname;
        return hostname;
    }
</script>
</body>
</html>
